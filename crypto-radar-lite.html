<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>RENVOX Crypto Radar ‚Äî Binance v3.2</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body{background:#0b0e12;color:#e2e8f0;font-family:Inter,Arial,sans-serif}
  .chip{padding:.3rem .6rem;border-radius:9999px;font-weight:600}
  a.btn{background:#16a34a;color:white;padding:.25rem .6rem;border-radius:.5rem;font-weight:600;transition:all .2s}
  a.btn:hover{background:#22c55e}
</style>
</head>
<body class="p-6">
<h1 class="text-3xl font-bold text-green-400 mb-2 text-center">RENVOX Crypto Radar ‚Äî Binance v3.2</h1>
<p class="text-gray-400 text-center mb-6">
Datos directos desde Binance API (velas 1h). RSI14 ¬∑ EMA20/50 ¬∑ Fibonacci (14d).<br>
Actualiza autom√°ticamente cada 1 hora. Incluye acceso a gr√°fico y an√°lisis autom√°tico.
</p>

<div class="overflow-x-auto border border-gray-700 rounded-xl">
<table class="w-full text-sm text-center" id="table">
  <thead class="bg-gray-800 text-gray-300">
    <tr>
      <th class="py-2">Token</th>
      <th class="py-2">Precio</th>
      <th class="py-2">RSI14</th>
      <th class="py-2">EMA20/50</th>
      <th class="py-2">Zona Fibo</th>
      <th class="py-2">Se√±al</th>
      <th class="py-2">Motivo</th>
      <th class="py-2">Gr√°fico</th>
    </tr>
  </thead>
  <tbody id="rows" class="bg-gray-900"></tbody>
</table>
</div>

<script>
const pairs=["BTCUSDT","ETHUSDT","SOLUSDT"];
const REFRESH_INTERVAL=3600000; // 1 hora

function ema(values,span){
  const k=2/(span+1);let emaArr=[values[0]];let prev=values[0];
  for(let i=1;i<values.length;i++){prev=values[i]*k+prev*(1-k);emaArr.push(prev);}
  return emaArr;
}
function rsi(values,period=14){
  let gains=0,losses=0;
  for(let i=1;i<=period;i++){const d=values[i]-values[i-1];if(d>=0)gains+=d;else losses-=d;}
  let avgG=gains/period,avgL=losses/period;
  for(let i=period+1;i<values.length;i++){
    const d=values[i]-values[i-1];const g=Math.max(d,0),l=Math.max(-d,0);
    avgG=(avgG*(period-1)+g)/period;avgL=(avgL*(period-1)+l)/period;
  }
  const rs=avgL===0?100:avgG/avgL;
  return 100-(100/(1+rs));
}

function motivo(signal,rsi){
  if(signal.includes("Pullback")) return "Zona de retroceso t√©cnico, posible rebote alcista.";
  if(signal.includes("Breakout")) return "Rompi√≥ resistencia, momentum positivo.";
  if(rsi<40) return "Sobreventa moderada, esperar confirmaci√≥n.";
  if(rsi>70) return "RSI alto, riesgo de correcci√≥n.";
  return "Tendencia lateral, sin se√±al clara.";
}

function linkGrafico(symbol){
  const base = symbol.replace("USDT","");
  return `https://www.tradingview.com/symbols/${base}USDT/`;
}

async function analyze(symbol){
  const url=`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1h&limit=500`;
  const r=await fetch(url);
  if(!r.ok) throw new Error(`HTTP ${r.status}`);
  const data=await r.json();
  if(!Array.isArray(data)||data.length===0) throw new Error(`Datos inv√°lidos (${symbol})`);

  const closes=data.map(k=>parseFloat(k[4]));
  const price=closes.at(-1);
  const ema20=ema(closes,20).at(-1);
  const ema50=ema(closes,50).at(-1);
  const rsi14=rsi(closes,14);
  const max=Math.max(...closes.slice(-24*14));
  const min=Math.min(...closes.slice(-24*14));
  const fib50=min+0.5*(max-min);
  const fib618=min+0.618*(max-min);
  const inZone=price>=fib50&&price<=fib618;
  const trendUp=ema20>ema50;

  let signal="‚ö™ Mirar",color="text-gray-300";
  if(inZone&&trendUp&&rsi14>=50&&rsi14<=65){signal="üü¢ Pullback";color="text-green-400";}
  else if(price>max&&trendUp&&rsi14>60){signal="üîµ Breakout";color="text-cyan-400";}
  else if(rsi14>70){signal="üî¥ Caliente";color="text-red-400";}

  const desc=motivo(signal,rsi14);
  const chart=linkGrafico(symbol);

  return `
    <tr class='border-b border-gray-800'>
      <td class='py-2 font-semibold'>${symbol}</td>
      <td>$${price.toFixed(2)}</td>
      <td>${rsi14.toFixed(1)}</td>
      <td>${ema20.toFixed(1)} / ${ema50.toFixed(1)}</td>
      <td>${fib50.toFixed(1)}‚Äì${fib618.toFixed(1)}</td>
      <td class='${color} font-bold'>${signal}</td>
      <td class='text-gray-300 text-sm'>${desc}</td>
      <td><a href='${chart}' target='_blank' class='btn'>Ver gr√°fico</a></td>
    </tr>`;
}

async function render(){
  const rows=document.getElementById('rows');
  rows.innerHTML=`<tr><td colspan='8' class='p-4 text-gray-400'>Cargando datos desde Binance...</td></tr>`;
  
  const promises=pairs.map(async(p)=>{
    try{return await analyze(p);}
    catch(e){
      console.warn("Error",p,e);
      return `<tr class='border-b border-gray-800 text-red-400'><td colspan='8'>Error ${p}: ${e.message}</td></tr>`;
    }
  });

  const results=await Promise.allSettled(promises);
  rows.innerHTML=results.map(r=>r.value||'').join('');
  console.log("‚úÖ Actualizaci√≥n completada:",new Date().toLocaleTimeString());
  setTimeout(render,REFRESH_INTERVAL);
}

render();
</script>

<p class="text-xs text-gray-500 mt-4 text-center">
v3.2 ‚Äî Procesamiento paralelo + explicaci√≥n autom√°tica + bot√≥n de gr√°fico.<br>
Datos en vivo desde Binance API (1h velas, 500 registros). Calcula RSI14, EMA20/50 y niveles Fibonacci (14d).
</p>
</body>
</html>
